#!/bin/sh

echo "----------------------------------------------------------------------"
echo "START: vltreimport"
echo "----------------------------------------------------------------------"

if [[  `pwd -P | sed 's!.*/!!'` == "jcr_root" ]]; then
if [[ `pwd -P | /bin/grep $BRANCH` ]]; then

    echo "----------------------------------------------------------------------"
    echo "START: find ./ -name .vlt      -type f -exec rm -vf  {} \;" 
    echo "START: find ./ -name nodetypes -type d -exec rm -Rvf {} \;" 
    echo "----------------------------------------------------------------------" 

    find ./ -name .vlt      -type f -exec rm -vf  {} \; 
    find ./ -name nodetypes -type d -exec rm -Rvf {} \;

    echo "----------------------------------------------------------------------" &&
    echo "END: find ./ -name .vlt      -type f -exec rm -vf  {} \;" && 
    echo "END: find ./ -name nodetypes -type d -exec rm -Rvf {} \;" && 
    echo "----------------------------------------------------------------------" &&
    echo "----------------------------------------------------------------------" &&
    echo "START: vlt --credentials admin:admin -v import http://localhost:4502/crx ./"  && 
    echo "----------------------------------------------------------------------" &&

    vlt --credentials admin:admin -v import http://localhost:4502/crx ./      && 

    echo "----------------------------------------------------------------------" &&
    echo "END: vlt --credentials admin:admin -v import http://localhost:4502/crx ./"  && 
    echo "----------------------------------------------------------------------" &&
    echo "----------------------------------------------------------------------" &&
    echo "START: vlt --credentials admin:admin -v co http://localhost:4502/crx --force" &&
    echo "----------------------------------------------------------------------" &&

    vlt --credentials admin:admin -v co     http://localhost:4502/crx --force &&

    echo "----------------------------------------------------------------------" &&
    echo "END: vlt --credentials admin:admin -v co http://localhost:4502/crx --force" &&
    echo "----------------------------------------------------------------------" &&
    echo "----------------------------------------------------------------------" &&
    echo "START: vlt up" &&
    echo "----------------------------------------------------------------------" &&

    vlt up && 

    echo "----------------------------------------------------------------------" &&
    echo "START: vlt up" &&
    echo "----------------------------------------------------------------------" &&
    echo "----------------------------------------------------------------------" &&
    echo "END: svn up" &&
    echo "----------------------------------------------------------------------" &&

    svn up && 

    echo "----------------------------------------------------------------------" &&
    echo "END: svn up" &&
    echo "----------------------------------------------------------------------" &&

    vltsyncci

else 
    echo "ERROR: /jcr_root not in \$BRANCH: $BRANCH != `pwd -P`"
fi;
else 
    echo "ERROR: Not in jcr_root directory"
fi;

echo "----------------------------------------------------------------------"
echo "END: vltreimport"
echo "----------------------------------------------------------------------"
